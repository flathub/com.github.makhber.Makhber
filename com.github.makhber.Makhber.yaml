app-id: com.github.makhber.Makhber
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '6.8'
command: makhber
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --filesystem=home
  - --filesystem=/media
  - --filesystem=/run/media
  - --device=dri

modules:
  - name: gsl
    buildsystem: autotools
    config-opts:
      - --disable-static
    cleanup:
      - /bin
      - /include
      - /lib/*.la
      - /lib/pkgconfig
      - /share
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/gsl/gsl-2.8.tar.gz
        sha256: 6a99eeed15632c6354895b1dd542ed5a855c0f15d9ad1326c6fe2b2c9e423190
        x-checker-data:
          type: anitya
          project-id: 1267
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/gsl/gsl-$version.tar.gz

  - name: muparser
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    cleanup:
      - /include
      - /lib/pkgconfig
      - /lib/cmake
    sources:
      - type: archive
        url: https://github.com/beltoforion/muparser/archive/v2.3.5.tar.gz
        sha256: 20b43cc68c655665db83711906f01b20c51909368973116dfc8d7b3c4ddb5dd4
        x-checker-data:
          type: anitya
          project-id: 2033
          stable-only: true
          url-template: https://github.com/beltoforion/muparser/archive/v$version.tar.gz

  - name: qwt
    buildsystem: simple
    build-commands:
      - sed -i "s|^\\s*QWT_INSTALL_PREFIX.*$|QWT_INSTALL_PREFIX=\"/app\"|g" qwtconfig.pri
      - sed -i "s|^QWT_CONFIG\\s*+=\\s*QwtDesigner$|#|g" qwtconfig.pri
      - sed -i "s|^QWT_CONFIG\\s*+=\\s*QwtExamples$|#|g" qwtconfig.pri
      - sed -i "s|^QWT_CONFIG\\s*+=\\s*QwtPlayground$|#|g" qwtconfig.pri
      - sed -i "s|^QWT_CONFIG\\s*+=\\s*QwtTests$|#|g" qwtconfig.pri
      - qmake CONFIG-=debug_and_release CONFIG+=release qwt.pro
      - make -j$(nproc)
      - make install
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/qwt/qwt-6.3.0.tar.bz2
        sha256: dcb085896c28aaec5518cbc08c0ee2b4e60ada7ac929d82639f6189851a6129a
        x-checker-data:
          type: anitya
          project-id: 4147
          stable-only: true
          url-template: http://downloads.sourceforge.net/qwt/qwt-$version.tar.bz2
    cleanup:
      - /lib/pkgconfig
      - /include
      - /doc
      - /features

  - name: glu
    buildsystem: meson
    sources:
      - type: archive
        url: https://mesa.freedesktop.org/archive/glu/glu-9.0.3.tar.xz
        sha256: bd43fe12f374b1192eb15fe20e45ff456b9bc26ab57f0eee919f96ca0f8a330f
        x-checker-data:
          type: anitya
          project-id: 13518
          stable-only: true
          url-template: https://mesa.freedesktop.org/archive/glu/glu-$version.tar.xz
    cleanup:
      - /include
      - /lib/*.a
      - /lib/*.la
      - /lib/pkgconfig

  - name: gl2ps
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: archive
        url: https://geuz.org/gl2ps/src/gl2ps-1.4.2.tgz
        sha256: 8d1c00c1018f96b4b97655482e57dcb0ce42ae2f1d349cd6d4191e7848d9ffe9
        x-checker-data:
          type: anitya
          project-id: 1173
          stable-only: true
          url-template: https://geuz.org/gl2ps/src/gl2ps-$version.tgz
    cleanup:
      - /lib/libgl2ps.a
      - /include
      - /share

  - name: python3-pyqt-builder
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pyqt-builder" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/88/ef/eb23f262cca3c0c4eb7ab1933c3b1f03d021f2c48f54763065b6f0e321be/packaging-24.2-py3-none-any.whl
        sha256: 09abb1bccd265c01f4a3aa3f7a7db064b36514d2cba19a2f694fe6150451a759
        x-checker-data:
          name: packaging
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/a2/7c/e3ff1467ac5e1e094c210a877c75dd872d9110f8e602cb7c0a4d620fd47c/PyQt_builder-1.17.0-py3-none-any.whl
        sha256: b8ee3a078918b4e178f1d0c7a621fa161a7f46884bfa46304dcb025459039ce8
        x-checker-data:
          name: PyQt_builder
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/0b/b5/aafbb1f35d53ae590d5c0455edc0694a355c3dac22a88392421789c4edd1/sip-6.9.1-py3-none-any.whl
        sha256: 071d8b920fdc1761330964abed829178ddb5154097b9fa4306b2fc6c6d9e57fc
        x-checker-data:
          name: sip
          packagetype: bdist_wheel
          type: pypi
    cleanup:
      - '*'

  - name: python3-pyqt6-sip
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pyqt6-sip" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/2a/e4/f39ca1fd6de7d4823d964a3ec33e85b6f51a9c2a7a1e95956b7a92c8acc9/pyqt6_sip-13.9.1.tar.gz
        sha256: 15be741d1ae8c82bb7afe9a61f3cf8c50457f7d61229a1c39c24cd6e8f4d86dc
        x-checker-data:
          type: pypi
          name: PyQt6-sip

  - name: pyqt6
    buildsystem: simple
    build-commands:
      - sip-install --confirm-license --build-dir ./build --target-dir /app/lib/python3.12/site-packages
        --no-designer-plugin --no-qml-plugin --no-tools
        --disable QtBluetooth --disable QtDBus --disable QtDesigner --disable QtHelp
        --disable QtMultimedia --disable QtMultimediaWidgets --disable QtNfc --disable QtPositioning
        --disable QtQml --disable QtQuick --disable QtQuick3D --disable QtQuickWidgets
        --disable QtRemoteObjects --disable QtSensors --disable QtSerialPort --disable QtSpatialAudio
        --disable QtSql --disable QtSvgWidgets --disable QtTest --disable QtTextToSpeech
        --disable QtWebChannel --disable QtWebSockets --disable QtXml
        --verbose --jobs $(nproc)
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/e9/0a/accbebed526158ab2aedd5c84d238159754bd99f481082b3fe7f374c6a3b/PyQt6-6.8.0.tar.gz
        sha256: 6d8628de4c2a050f0b74462e4c9cb97f839bf6ffabbca91711722ffb281570d9
        x-checker-data:
          type: pypi
          name: PyQt6
    cleanup:
      - /lib/python3.12/site-packages/PyQt6/bindings

  - name: makhber
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=ON
      - -DMAKHBER_SEARCH_FOR_UPDATES=OFF
      - -DMAKHBER_DOWNLOAD_LINKS=OFF
      - -DMAKHBER_SCRIPTING_PYTHON=ON
    sources:
      - type: archive
        url: https://github.com/Makhber/makhber/releases/download/0.10.0-alpha3/Makhber-0.10.0-alpha3-src.tar.xz
        sha256: 88ded353cf08a15866e7ab320b760001e9bd62b76aa22861eb75575cf945306d
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Makhber/makhber/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name=="Makhber-" + $version + "-src.tar.xz")
            | .browser_download_url
