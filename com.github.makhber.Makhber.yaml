app-id: com.github.makhber.Makhber
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: 5.15-25.08
command: makhber
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --filesystem=home
  - --filesystem=/media
  - --filesystem=/run/media
  - --device=dri

modules:
  - name: gsl
    buildsystem: autotools
    config-opts:
      - --disable-static
    cleanup:
      - /bin
      - /include
      - /lib/*.la
      - /lib/pkgconfig
      - /share
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/gsl/gsl-2.8.tar.gz
        sha256: 6a99eeed15632c6354895b1dd542ed5a855c0f15d9ad1326c6fe2b2c9e423190
        x-checker-data:
          type: anitya
          project-id: 1267
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/gsl/gsl-$version.tar.gz

  - name: muparser
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    cleanup:
      - /include
      - /lib/pkgconfig
      - /lib/cmake
    sources:
      - type: archive
        url: https://github.com/beltoforion/muparser/archive/v2.3.5.tar.gz
        sha256: 20b43cc68c655665db83711906f01b20c51909368973116dfc8d7b3c4ddb5dd4
        x-checker-data:
          type: anitya
          project-id: 2033
          stable-only: true
          url-template: https://github.com/beltoforion/muparser/archive/v$version.tar.gz

  - name: glu
    buildsystem: meson
    sources:
      - type: archive
        url: https://mesa.freedesktop.org/archive/glu/glu-9.0.3.tar.xz
        sha256: bd43fe12f374b1192eb15fe20e45ff456b9bc26ab57f0eee919f96ca0f8a330f
        x-checker-data:
          type: anitya
          project-id: 13518
          stable-only: true
          url-template: https://mesa.freedesktop.org/archive/glu/glu-$version.tar.xz
    cleanup:
      - /include
      - /lib/*.a
      - /lib/*.la
      - /lib/pkgconfig

  - name: gl2ps
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
    sources:
      - type: archive
        url: https://geuz.org/gl2ps/src/gl2ps-1.4.2.tgz
        sha256: 8d1c00c1018f96b4b97655482e57dcb0ce42ae2f1d349cd6d4191e7848d9ffe9
        x-checker-data:
          type: anitya
          project-id: 1173
          stable-only: true
          url-template: https://geuz.org/gl2ps/src/gl2ps-$version.tgz
    cleanup:
      - /lib/libgl2ps.a
      - /include
      - /share

  - name: liborigin
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/liborigin/liborigin/3.0/liborigin-3.0.3.tar.gz
        sha256: b394e3bf633888f9f4a3e1449d7c7eb39b778a2e657424177a04cde4afe6965a
    cleanup:
      - /bin/opj2dat
      - /lib/liborigin.a
      - /include
      - /share

  - name: python3-pyqt-builder
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pyqt-builder" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/20/12/38679034af332785aac8774540895e234f4d07f7545804097de4b666afd8/packaging-25.0-py3-none-any.whl
        sha256: 29572ef2b1f17581046b3a2227d5c611fb25ec70ca1ba8554b24b0e69331a484
        x-checker-data:
          name: packaging
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/36/02/9671bb3cd635ae3b710c0f96c2c8e4bba85802dfd114f0bd88dc12196730/pyqt_builder-1.19.0-py3-none-any.whl
        sha256: a1150ef6bb0fc2677ec78470a47d915ceeea7d1e77ea33d86f3408ed48bd78d1
        x-checker-data:
          name: PyQt_builder
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/c5/ec/17cfdfcc511b821ef76b06d843140f6a4c19fac18764b6a96b23352b3988/sip-6.14.0-py3-none-any.whl
        sha256: 35fe63c3e2862b12656a2c50e622cc471143e7cb8d56ac639eb2990be3352970
        x-checker-data:
          name: sip
          packagetype: bdist_wheel
          type: pypi
    cleanup:
      - '*'

  - name: python3-pyqt5-sip
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pyqt5-sip" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ea/08/88a20c862f40b5c178c517cdc7e93767967dec5ac1b994e226d517991c9b/pyqt5_sip-12.17.1.tar.gz
        sha256: 0eab72bcb628f1926bf5b9ac51259d4fa18e8b2a81d199071135458f7d087ea8
        x-checker-data:
          type: pypi
          name: PyQt5-sip

  - name: pyqt5
    buildsystem: simple
    build-commands:
      - sip-install --confirm-license --build-dir ./build --target-dir /app/lib/python3.13/site-packages
        --concatenate $(nproc) --no-designer-plugin --no-qml-plugin --no-tools --disable
        QtQml --disable QtBluetooth --disable QtDBus --disable QtDesigner --disable
        QtHelp --disable QtMultimedia --disable QtMultimediaWidgets --disable QtNfc
        --disable QtRemoteObjects --disable QtPositioning --disable QtLocation --disable
        QtQuick --disable QtQuickWidgets --disable QtSensors --disable QtSerialPort
        --disable QtSql --disable QtTest --disable QtTextToSpeech --disable QtWebChannel
        --disable QtWebKit --disable QtWebKitWidgets --disable QtWebSockets --disable
        QtX11Extras --disable QtXml --disable QtXmlPatterns --verbose --jobs $(nproc)
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/0e/07/c9ed0bd428df6f87183fca565a79fee19fa7c88c7f00a7f011ab4379e77a/PyQt5-5.15.11.tar.gz
        sha256: fda45743ebb4a27b4b1a51c6d8ef455c4c1b5d610c90d2934c7802b5c1557c52
        x-checker-data:
          type: pypi
          name: PyQt5
    cleanup:
      - /lib/python3.13/site-packages/PyQt5/bindings

  - name: makhber
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DMAKHBER_SEARCH_FOR_UPDATES=OFF
      - -DMAKHBER_DOWNLOAD_LINKS=OFF
      - -DMAKHBER_SCRIPTING_PYTHON=ON
    sources:
      - type: archive
        url: https://github.com/Makhber/makhber/releases/download/0.9.8.3/Makhber-0.9.8.3-src.tar.xz
        sha256: 4f5179cc1fbf27f2294591b35be9d0850826226a2fab4514b00682a7fc97d1c4
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Makhber/makhber/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name=="Makhber-" + $version + "-src.tar.xz")
            | .browser_download_url
